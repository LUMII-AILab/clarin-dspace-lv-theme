!function(t){function i(t,i){return t.replace(/\{([^\}]+)\}/g,function(t,n){return n in i?encodeURIComponent(i[n]):t})}function n(o,d){var l=this;if(d||(d={}),!(l instanceof n))return new n(o,d);["uri","oai","handle","title"].forEach(function(t){var i=d[t]||o.getAttribute(t);if(o.removeAttribute(t),!i)throw new Error("CitationBox: Option '"+t+"' not specified.");l[t]=i});var r=e.map(function(i){return t("<a></a>").attr("href",l.oai+"/cite?metadataPrefix="+i.name+"&handle="+l.handle).on("click",function(t){t.preventDefault(),l.request(i.name).done(function(t){i.extract&&(t=i.extract(t)),l.modal(l.title,t)})}).text(i.name)}),c=a.map(function(n){var e=n.popup,a=i(e.url,l);return t("<a></a>").attr("class","lindat-icon lindat-icon-"+n.name+" lindat-share-"+n.name).attr("href",a).on("click",function(t){t.preventDefault(),window.open(a,l.title,"height:"+e.height+",width:"+e.width)})}),s=l.body=t(n.template);s.find("[citation-box-formats]").append(r),s.find("[citation-box-shares]").append(c),l.text=s.find("[citation-box-text]"),l.copyButton=s.find("[citation-box-copy-button]"),t(o).empty().append(s),l.init()}var e=[{name:"bibtex",extract:function(i){var n="",e=[];i=t.trim(i).replace(/\n\s+/gm,"\n").split("\n");for(var a=0;a<i.length;a++){for(var o=i[a],d=0,l=0;l<o.length;l++){var r=o[l];"{"===r?d+=1:"}"===r&&(d-=1)}if(0>d)n=n.slice(0,-2*Math.abs(d)),e.push(n+o);else if(d>0){e.push(n+o);for(var c=0;d>c;c++)n+="  "}else e.push(n+o)}return e.join("\n")}},{name:"cmdi",extract:function(t){return t[0].documentElement.outerHTML}}],a=[{name:"facebook",popup:{url:"http://www.facebook.com/sharer/sharer.php?u={uri}",width:600,height:500}},{name:"twitter",popup:{url:"http://twitter.com/intent/tweet?url={uri}&text={title}",width:600,height:450}},{name:"google-plus",popup:{url:"https://plus.google.com/share?url={uri}",width:700,height:500}}];n.prototype.init=function(){function t(){n.empty().html("<a href='"+i.uri+"'>"+i.uri+"</a>")}var i=this,n=i.text,e=i.copyButton;i.request("html").done(function(t){n.empty().append(t),e.on("click",function(t){t.preventDefault(),i.modal(i.title,n.text())}),i.body.removeClass("lindat-loading")}).fail(t)},n.prototype.request=function(i){var n=this.oai+"/cite?metadataPrefix="+i+"&handle="+this.handle,e=t.Deferred();return t.ajax(n,{dataType:"xml",cache:!0}).done(function(n){n=t(n);var a=n.find("error");if(a.length)e.reject();else{var o=n.find(i);e.resolve(o.length?o.html():n)}}).fail(e.reject),e},n.prototype.modal=function(i,n){function e(){return r?void(r=!1):(h.removeClass(s),o.remove(),t(document).off(".lindat"),void t(window).off(".lindat"))}function a(){c.focus().select()}var o,d,l,r,c,s="lindat-modal-open",h=t("html");h.hasClass(s)||(h.addClass(s),o=t('<div class="lindat-overlay"></div>').on("click",e).appendTo(document.body),d=t('<div class="lindat-modal" role="dialog"></div>').on("click",function(){r=!0}).appendTo(o),l=t('<div class="lindat-modal-close-button">&#xD7;</div>').on("click",e),t('<div class="lindat-modal-header"></div>').append(t("<h3></h3>").text(i).append(t("<p>Press <kbd>ctrl + c</kbd> to copy</p>"))).append(l).appendTo(d),c=t('<textarea readonly="readonly"></textarea>').on("mouseover",a).text(n),t('<div class="lindat-modal-body"></div>').append(c).appendTo(d),a(),t(document).on("keydown.lindat",function(t){27===t.keyCode&&e()}),t(window).on("hashchange.lindat",e))},window.LindatCitationBox=n,t.fn.lindatCitationBox=function(){var i="lindat-citation-box";return this.each(function(){var e=t(this),a=e.data(i);a||e.data(i,new n(this))}),this},window.LindatCitationBox.template='<div class="lindat-citation-box lindat-loading"><div class="lindat-cb-top"><div class="lindat-cb-header"><div class="lindat-icon lindat-header-icon lindat-icon-quote"></div><h3>Please use the following text to cite this item or export to a predefined format:</h3><div class="lindat-cb-formats" citation-box-formats=""></div></div><div class="lindat-cb-body"><div class="lindat-cb-text" citation-box-text=""><div class="lindat-loader"><div></div><div></div><div></div></div></div><div><button class="lindat-cb-copy lindat-icon lindat-icon-copy" citation-box-copy-button=""></button></div></div></div><div class="lindat-cb-footer"><div class="lindat-cb-integration"><div class="lindat-cb-header"><div class="lindat-icon lindat-header-icon lindat-icon-puzzle"></div><h3>This resource is also integrated in following services:</h3></div><div class="lindat-cb-services"><a href="#">PML-TQ</a> <a href="#">KonText</a></div></div><div class="lindat-cb-share"><div class="lindat-cb-header"><div class="lindat-icon lindat-header-icon lindat-icon-share"></div><h3>Share:</h3></div><div class="lindat-cb-shares" citation-box-shares=""></div></div></div></div>'}(jQuery);