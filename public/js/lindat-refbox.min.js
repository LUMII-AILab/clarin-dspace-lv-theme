!function(t){function e(t,e){return t.replace(/\{([^\}]+)\}/g,function(t,n){return n in e?encodeURIComponent(e[n]):t})}function n(e){function n(){a&&(a=!1,e.hide(),t(document).off("click.refbox"))}var a=!1;return t("<button></button>").addClass("lindat-button lindat-dropdown-toggle").attr("type","button").append(t("<span></span>").addClass("lindat-dropdown-caret")).click(function(){a?n():(setTimeout(function(){t(document).on("click.refbox",n)}),e.show(),a=!0)})}function a(e,n){var i=this;if(n||(n={}),!(i instanceof a))return new a(e,n);["handle","title"].forEach(function(t){if(!n[t]){var a=e.getAttribute(t);if(e.removeAttribute(t),!a)throw new Error("RefBox: Option '"+t+"' not specified.");i[t]=a}});var o=i.body=t(a.template);i.formatsContainer=o.find("[refbox-formats]"),i.sharesContainer=o.find("[refbox-shares]"),i.integrationContainer=o.find("[refbox-integrations]"),Object.keys(n).forEach(function(t){i[t]=n[t]}),i.uri="http://hdl.handle.net/"+i.handle,i.requestQueue=[],i.text=o.find("[refbox-text]"),i.copyButton=o.find("[refbox-copy-button]"),i.container=t(e).empty().append(o),i.init()}var i=[{name:"facebook",popup:{url:"http://www.facebook.com/sharer/sharer.php?u={uri}",width:600,height:500}},{name:"twitter",popup:{url:"http://twitter.com/intent/tweet?url={uri}&text={title}",width:600,height:450}},{name:"google-plus",popup:{url:"https://plus.google.com/share?url={uri}",width:700,height:500}}];a.prototype.init=function(){function a(){d.empty().html("<a href='"+o.uri+"'>"+o.uri+"</a>")}var o=this,d=o.text,r=o.copyButton;o.fetchInitial().done(function(a){a.title&&(o.title=a.title);var l=a.exportFormats.exportFormat;l&&l.length>0&&l.forEach(function(e){var n=t("<a></a>").attr("href",e.url).on("click",function(t){t.preventDefault(),o.request(e).done(function(t){o.modal(o.title,t,e.name)})}).text(e.name);o.formatsContainer.append(n)}),a.displayText&&(d.empty().append(a.displayText),r.on("click",function(t){t.preventDefault(),o.modal(o.title,d.text())}),o.body.removeClass("lindat-loading"));var s=a.featuredServices.featuredService;if(s&&s.length>0){var c=o.integrationContainer.find("[refbox-services]");s.forEach(function(e){var a=e.links,i=t("<a></a>").addClass("lindat-button").attr("target","_blank").attr("title",e.description).attr("href",e.url).text(e.name);if(a&&a.entry.length>0){var o=t("<ul></ul>").addClass("lindat-dropdown-menu"),d=t("<div></div>").addClass("lindat-dropdown").append(i).append(n(o)).append(o);a.entry.forEach(function(e){o.append(t("<li></li>").append(t("<a></a>").attr("target","_blank").attr("href",e.value).text(e.key)))}),c.append(d)}else c.append(i)})}else o.integrationContainer.remove();i.forEach(function(n){var a=n.popup,i=e(a.url,o),d=t("<a></a>").attr("class","lindat-icon lindat-icon-"+n.name+" lindat-share-"+n.name).attr("href",i).on("click",function(t){t.preventDefault(),window.open(i,o.title,"height:"+a.height+",width:"+a.width)});o.sharesContainer.append(d)})}).fail(a)},a.prototype.ajax=function(){var e=this,n=t.ajax.apply(t,arguments);return e.requestQueue.push(n),n.always(function(){var t=e.requestQueue.indexOf(n);-1!==t&&e.requestQueue.splice(t,1)})},a.prototype.request=function(e){var n=t.Deferred();return this.ajax(e.url,{dataType:e.dataType,cache:!0}).done(function(a){if("xml"===e.dataType){var i=t(a),o=i.find("error");if(o.length)n.reject();else{var d=i.find(e.name);n.resolve(d.length?d.html():i)}}else n.resolve(a.value)}).fail(n.reject),n},a.prototype.fetchInitial=function(){var t=this.rest+"/handle/"+this.handle+"/refbox";return this.ajax(t,{dataType:"json",cache:!0})},a.prototype.modal=function(e,n,a){function i(e){return e!==!0&&s?void(s=!1):(f.modalInstance=null,u.removeClass(p),d.remove(),t(document).off(".lindat"),void t(window).off(".lindat"))}function o(){c.focus().select()}var d,r,l,s,c,f=this,p="lindat-modal-open",u=t("html");u.hasClass(p)||(u.addClass(p),d=t('<div class="lindat-overlay"></div>').on("click",i).appendTo(document.body),r=t('<div class="lindat-modal" role="dialog"></div>').on("click",function(){s=!0}).appendTo(d),l=t('<div class="lindat-modal-close-button">&#xD7;</div>').on("click",i),t('<div class="lindat-modal-header"></div>').append(t("<h3></h3>").text(e).append(t("<p>Press <kbd>ctrl + c</kbd> to copy</p>"))).append(l).appendTo(r),c=t('<textarea readonly="readonly"></textarea>').on("mouseover",o).text(n),t('<div class="lindat-modal-body"></div>').append(c).appendTo(r),a&&t('<div class="lindat-modal-footer"></div>').text(a).appendTo(r),o(),f.modalInstance={element:r,overlay:d,destroy:i},t(document).on("keydown.lindat",function(t){27===t.keyCode&&i()}),t(window).on("hashchange.lindat",i))},a.prototype.destroy=function(){var t,e=this;for(e.modalInstance&&e.modalInstance.destroy(!0);t=e.requestQueue.pop();)t.abort()},window.LindatRefBox=a,t.fn.lindatRefBox=function(e){var n=t.extend({},{rest:"https://lindat.mff.cuni.cz/repository/rest"},e),i="lindat-refbox";return this.each(function(){var e=t(this),o=e.data(i);o&&o.destroy(),e.data(i,new a(this,n))}),this},t(document).ready(function(){window.LindatRefBoxConfig||(window.LindatRefBoxConfig={}),t(".refbox").lindatRefBox(window.LindatRefBoxConfig)}),window.LindatRefBox.template='<div class="lindat-refbox lindat-loading"><div class="lindat-refbox-top"><div class="lindat-refbox-header"><div class="lindat-icon lindat-header-icon lindat-icon-quote"></div><h3>Please use the following text to cite this item or export to a predefined format:</h3><div class="lindat-refbox-formats" refbox-formats=""></div></div><div class="lindat-refbox-body"><div class="lindat-refbox-text" refbox-text=""><div class="lindat-loader"><div></div><div></div><div></div></div></div><div><button class="lindat-refbox-copy lindat-icon lindat-icon-copy" refbox-copy-button=""></button></div></div></div><div class="lindat-refbox-footer"><div class="lindat-refbox-integration" refbox-integrations=""><div class="lindat-refbox-header"><div class="lindat-icon lindat-header-icon lindat-icon-puzzle"></div><h3>This resource is also integrated in following services:</h3></div><div class="lindat-refbox-services" refbox-services=""></div></div><div class="lindat-refbox-header"><div class="lindat-icon lindat-header-icon lindat-icon-share"></div><h3>Share:</h3><div class="lindat-refbox-shares" refbox-shares=""></div></div></div></div>'}(jQuery);