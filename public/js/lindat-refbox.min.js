!function(t){function e(t,e){return t.replace(/\{([^\}]+)\}/g,function(t,n){return n in e?encodeURIComponent(e[n]):t})}function n(e){function n(){i&&(i=!1,e.hide(),t(document).off("click.refbox"))}var i=!1;return t("<button></button>").addClass("lindat-button lindat-dropdown-toggle").attr("type","button").append(t("<span></span>").addClass("lindat-dropdown-caret")).click(function(){i?n():(setTimeout(function(){t(document).on("click.refbox",n)}),e.show(),i=!0)})}function i(e,n){var a=this;if(n||(n={}),!(a instanceof i))return new i(e,n);["handle","title"].forEach(function(t){var n=e.getAttribute(t);if(e.removeAttribute(t),!n)throw new Error("RefBox: Option '"+t+"' not specified.");a[t]=n});var o=a.body=t(i.template);a.formatsContainer=o.find("[refbox-formats]"),a.sharesContainer=o.find("[refbox-shares]"),a.integrationContainer=o.find("[refbox-integrations]"),Object.keys(n).forEach(function(t){a[t]=n[t]}),a.uri="http://hdl.handle.net/"+a.handle,a.text=o.find("[refbox-text]"),a.copyButton=o.find("[refbox-copy-button]"),t(e).empty().append(o),a.init()}var a=[{name:"facebook",popup:{url:"http://www.facebook.com/sharer/sharer.php?u={uri}",width:600,height:500}},{name:"twitter",popup:{url:"http://twitter.com/intent/tweet?url={uri}&text={title}",width:600,height:450}},{name:"google-plus",popup:{url:"https://plus.google.com/share?url={uri}",width:700,height:500}}];i.prototype.init=function(){function i(){d.empty().html("<a href='"+o.uri+"'>"+o.uri+"</a>")}var o=this,d=o.text,r=o.copyButton;o.fetchInitial().done(function(i){i.title&&(o.title=i.title);var l=i.exportFormats.exportFormat;l&&l.length>0&&l.forEach(function(e){var n=t("<a></a>").attr("href",e.url).on("click",function(t){t.preventDefault(),o.request(e).done(function(t){o.modal(o.title,t,e.name)})}).text(e.name);o.formatsContainer.append(n)}),i.displayText&&(d.empty().append(i.displayText),r.on("click",function(t){t.preventDefault(),o.modal(o.title,d.text())}),o.body.removeClass("lindat-loading"));var s=i.featuredServices.featuredService;if(s&&s.length>0){var c=o.integrationContainer.find("[refbox-services]");s.forEach(function(e){var i=e.links,a=t("<a></a>").addClass("lindat-button").attr("target","_blank").attr("title",e.description).attr("href",e.url).text(e.name);if(i&&i.entry.length>0){var o=t("<ul></ul>").addClass("lindat-dropdown-menu"),d=t("<div></div>").addClass("lindat-dropdown").append(a).append(n(o)).append(o);i.entry.forEach(function(e){o.append(t("<li></li>").append(t("<a></a>").attr("target","_blank").attr("href",e.value).text(e.key)))}),c.append(d)}else c.append(a)})}else o.integrationContainer.remove();a.forEach(function(n){var i=n.popup,a=e(i.url,o),d=t("<a></a>").attr("class","lindat-icon lindat-icon-"+n.name+" lindat-share-"+n.name).attr("href",a).on("click",function(t){t.preventDefault(),window.open(a,o.title,"height:"+i.height+",width:"+i.width)});o.sharesContainer.append(d)})}).fail(i)},i.prototype.request=function(e){var n=t.Deferred();return t.ajax(e.url,{dataType:e.dataType,cache:!0}).done(function(i){if("xml"===e.dataType){var a=t(i),o=a.find("error");if(o.length)n.reject();else{var d=a.find(e.name);n.resolve(d.length?d.html():a)}}else n.resolve(i.value)}).fail(n.reject),n},i.prototype.fetchInitial=function(){var e=this.rest+"/handle/"+this.handle+"/refbox";return t.getJSON(e)},i.prototype.modal=function(e,n,i){function a(){return s?void(s=!1):(p.removeClass(f),d.remove(),t(document).off(".lindat"),void t(window).off(".lindat"))}function o(){c.focus().select()}var d,r,l,s,c,f="lindat-modal-open",p=t("html");p.hasClass(f)||(p.addClass(f),d=t('<div class="lindat-overlay"></div>').on("click",a).appendTo(document.body),r=t('<div class="lindat-modal" role="dialog"></div>').on("click",function(){s=!0}).appendTo(d),l=t('<div class="lindat-modal-close-button">&#xD7;</div>').on("click",a),t('<div class="lindat-modal-header"></div>').append(t("<h3></h3>").text(e).append(t("<p>Press <kbd>ctrl + c</kbd> to copy</p>"))).append(l).appendTo(r),c=t('<textarea readonly="readonly"></textarea>').on("mouseover",o).text(n),t('<div class="lindat-modal-body"></div>').append(c).appendTo(r),i&&t('<div class="lindat-modal-footer"></div>').text(i).appendTo(r),o(),t(document).on("keydown.lindat",function(t){27===t.keyCode&&a()}),t(window).on("hashchange.lindat",a))},window.LindatRefBox=i,t.fn.lindatRefBox=function(e){var n=t.extend({},{rest:"https://lindat.mff.cuni.cz/repository/rest"},e),a="lindat-refbox";return this.each(function(){var e=t(this),o=e.data(a);o||e.data(a,new i(this,n))}),this},t(document).ready(function(){window.LindatRefBoxConfig||(window.LindatRefBoxConfig={}),t(".refbox").lindatRefBox(window.LindatRefBoxConfig)}),window.LindatRefBox.template='<div class="lindat-refbox lindat-loading"><div class="lindat-refbox-top"><div class="lindat-refbox-header"><div class="lindat-icon lindat-header-icon lindat-icon-quote"></div><h3>Please use the following text to cite this item or export to a predefined format:</h3><div class="lindat-refbox-formats" refbox-formats=""></div></div><div class="lindat-refbox-body"><div class="lindat-refbox-text" refbox-text=""><div class="lindat-loader"><div></div><div></div><div></div></div></div><div><button class="lindat-refbox-copy lindat-icon lindat-icon-copy" refbox-copy-button=""></button></div></div></div><div class="lindat-refbox-footer"><div class="lindat-refbox-integration" refbox-integrations=""><div class="lindat-refbox-header"><div class="lindat-icon lindat-header-icon lindat-icon-puzzle"></div><h3>This resource is also integrated in following services:</h3></div><div class="lindat-refbox-services" refbox-services=""></div></div><div class="lindat-refbox-header"><div class="lindat-icon lindat-header-icon lindat-icon-share"></div><h3>Share:</h3><div class="lindat-refbox-shares" refbox-shares=""></div></div></div></div>'}(jQuery);