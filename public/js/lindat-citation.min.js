!function(t){function i(t,i){return t.replace(/\{([^\}]+)\}/g,function(t,n){return n in i?encodeURIComponent(i[n]):t})}function n(o,d){var l=this;if(d||(d={}),!(l instanceof n))return new n(o,d);["handle","title"].forEach(function(t){var i=o.getAttribute(t);if(o.removeAttribute(t),!i)throw new Error("CitationBox: Option '"+t+"' not specified.");l[t]=i});var c=l.body=t(n.template),r=c.find("[citation-box-formats]"),s=c.find("[citation-box-shares]");Object.keys(d).forEach(function(t){l[t]=d[t]}),l.uri="http://hdl.handle.net/"+l.handle,a.forEach(function(i){var n=t("<a></a>").attr("href",l.oai+"/cite?metadataPrefix="+i.name+"&handle="+l.handle).on("click",function(t){t.preventDefault(),l.request(i.name).done(function(t){i.extract&&(t=i.extract(t)),l.modal(l.title,t)})}).text(i.name);r.append(n)});e.map(function(n){var a=n.popup,e=i(a.url,l),o=t("<a></a>").attr("class","lindat-icon lindat-icon-"+n.name+" lindat-share-"+n.name).attr("href",e).on("click",function(t){t.preventDefault(),window.open(e,l.title,"height:"+a.height+",width:"+a.width)});s.append(o)});l.text=c.find("[citation-box-text]"),l.copyButton=c.find("[citation-box-copy-button]"),t(o).empty().append(c),l.init()}var a=[{name:"bibtex",extract:function(i){var n="",a=[];i=t.trim(i).replace(/\n\s+/gm,"\n").split("\n");for(var e=0;e<i.length;e++){for(var o=i[e],d=0,l=0;l<o.length;l++){var c=o[l];"{"===c?d+=1:"}"===c&&(d-=1)}if(0>d)n=n.slice(0,-2*Math.abs(d)),a.push(n+o);else if(d>0){a.push(n+o);for(var r=0;d>r;r++)n+="  "}else a.push(n+o)}return a.join("\n")}},{name:"cmdi",extract:function(t){return t[0].documentElement.outerHTML}}],e=[{name:"facebook",popup:{url:"http://www.facebook.com/sharer/sharer.php?u={uri}",width:600,height:500}},{name:"twitter",popup:{url:"http://twitter.com/intent/tweet?url={uri}&text={title}",width:600,height:450}},{name:"google-plus",popup:{url:"https://plus.google.com/share?url={uri}",width:700,height:500}}];n.prototype.init=function(){function t(){n.empty().html("<a href='"+i.uri+"'>"+i.uri+"</a>")}var i=this,n=i.text,a=i.copyButton;i.request("html").done(function(t){n.empty().append(t),a.on("click",function(t){t.preventDefault(),i.modal(i.title,n.text())}),i.body.removeClass("lindat-loading")}).fail(t)},n.prototype.request=function(i){var n=this.oai+"/cite?metadataPrefix="+i+"&handle="+this.handle,a=t.Deferred();return t.ajax(n,{dataType:"xml",cache:!0}).done(function(n){n=t(n);var e=n.find("error");if(e.length)a.reject();else{var o="html"===i?n.contents():n.find(i);a.resolve(o.length?o.html():n)}}).fail(a.reject),a},n.prototype.modal=function(i,n){function a(){return c?void(c=!1):(h.removeClass(s),o.remove(),t(document).off(".lindat"),void t(window).off(".lindat"))}function e(){r.focus().select()}var o,d,l,c,r,s="lindat-modal-open",h=t("html");h.hasClass(s)||(h.addClass(s),o=t('<div class="lindat-overlay"></div>').on("click",a).appendTo(document.body),d=t('<div class="lindat-modal" role="dialog"></div>').on("click",function(){c=!0}).appendTo(o),l=t('<div class="lindat-modal-close-button">&#xD7;</div>').on("click",a),t('<div class="lindat-modal-header"></div>').append(t("<h3></h3>").text(i).append(t("<p>Press <kbd>ctrl + c</kbd> to copy</p>"))).append(l).appendTo(d),r=t('<textarea readonly="readonly"></textarea>').on("mouseover",e).text(n),t('<div class="lindat-modal-body"></div>').append(r).appendTo(d),e(),t(document).on("keydown.lindat",function(t){27===t.keyCode&&a()}),t(window).on("hashchange.lindat",a))},window.LindatCitationBox=n,t.fn.lindatCitationBox=function(i){var a=t.extend({},{rest:"https://lindat.mff.cuni.cz/repository/rest",oai:"https://lindat.mff.cuni.cz/repository/oai"},i),e="lindat-citation-box";return this.each(function(){var i=t(this),o=i.data(e);o||i.data(e,new n(this,a))}),this},t(document).ready(function(){window.LindatCitationBoxConfig||(window.LindatCitationBoxConfig={}),t(".citationbox").lindatCitationBox(window.LindatCitationBoxConfig)}),window.LindatCitationBox.template='<div class="lindat-citation-box lindat-loading"><div class="lindat-cb-top"><div class="lindat-cb-header"><div class="lindat-icon lindat-header-icon lindat-icon-quote"></div><h3>Please use the following text to cite this item or export to a predefined format:</h3><div class="lindat-cb-formats" citation-box-formats=""></div></div><div class="lindat-cb-body"><div class="lindat-cb-text" citation-box-text=""><div class="lindat-loader"><div></div><div></div><div></div></div></div><div><button class="lindat-cb-copy lindat-icon lindat-icon-copy" citation-box-copy-button=""></button></div></div></div><div class="lindat-cb-footer"><div class="lindat-cb-integration"><div class="lindat-cb-header"><div class="lindat-icon lindat-header-icon lindat-icon-puzzle"></div><h3>This resource is also integrated in following services:</h3></div><div class="lindat-cb-services"><a href="#">PML-TQ</a> <a href="#">KonText</a></div></div><div class="lindat-cb-header"><div class="lindat-icon lindat-header-icon lindat-icon-share"></div><h3>Share:</h3><div class="lindat-cb-shares" citation-box-shares=""></div></div></div></div>'}(jQuery);