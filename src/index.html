<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LINDAT/CLARIN Research Infrastructure</title>
    <meta name="viewport" content="width=device-width">
    <meta name="keywords" content="Language Resources, Infrastructure, Research,
          Natural Language Processing, Multimedia, Czech language, Computational
          Linguistics, Speech, Text, Corpus, Corpora" />
    <meta name="description" content="LINDAT CLARIN Research Infrastructure" />
    <!-- inject:css -->
    <!-- css files will be automatically insert here -->
    <!-- endinject -->
    <style>
      html {
        height: 100%;
      }
      pre {
        display: block;
        padding: 9px;
        margin: 10px 0 10px;
        font-size: 13px;
        line-height: 1.428571429;
        color: #333;
        word-break: break-all;
        word-wrap: break-word;
        background-color: #f5f5f5;
        border: 1px solid #CCC;
        border-radius: 4px;
      }
      body {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        height: 100%;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        -ms-flex-direction: column;
        flex-direction: column
      }

      footer, header {
        -webkit-box-flex: 0;
        -webkit-flex: none;
        -ms-flex: none;
        flex: none
      }

      section {
        -webkit-box-flex: 1;
        -webkit-flex: 1 0 auto;
        -ms-flex: 1 0 auto;
        flex: 1 0 auto;
        width: 100%
      }

      section::after {
        content: '\00a0';
        display: block;
        height: 0;
        clear: both;
        margin-top: 3.5em;
        visibility: hidden
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header>
    </header>
    <section class="lindat-common lindat-container">
      <h1>LINDAT/CLARIN Common Theme</h1>
      <p>
        Select the theme you want...
      </p>
      <div>
        <label>Load other project CSS:</label>
        <button class="css-select" value="">Clear</button>
        <button class="css-select" value="https://lindat.mff.cuni.cz/repository/xmlui/">Lindat Repository</button>
        <button class="css-select" value="https://ufal-point-dev.ms.mff.cuni.cz/dspace5l/xmlui/">UFAL Point Dev</button>
        <button class="css-select" value="http://lindat.mff.cuni.cz/services/pmltq/">PML-TQ</button>
        <button class="css-select" value="https://lindat.mff.cuni.cz/services/kontext/run.cgi/corplist">Kontext</button>
        <pre id="loaded-styles"></pre>
      </div>
      <p>
        <label>Select Language:</label>
        <button class="lang-select" value="en">English</button>
        <button class="lang-select" value="cs">Czech</button>
      </p>
      <p>
        <label>Select active project:</label>
        <button class="project-select" value="lindat-home">Home</button>
        <button class="project-select" value="lindat-repository">Repository</button>
        <button class="project-select" value="lindat-pmltq">PML-TQ</button>
        <button class="project-select" value="lindat-tools">Any</button>
      </p>
      <h1>Refbox</h1>
      <p>
        <label>Switch items:</label>
        <button class="handle-select" value="non_existing">Non existing handle</button>
        <button class="handle-select" value="11234/1-1508">HamleDT 3.0</button>
        <button class="handle-select" value="11858/00-097C-0000-0023-1AAF-3">Prague Dependency Treebank 3.0</button>
      </p>
      <div id="refbox">
      </div>
    </section>
    <footer>
    </footer>
    <!-- bower:js -->
    <!-- js bower dependencies will be automatically insert here -->
    <!-- endbower -->
    <!-- inject:js -->
    <!-- js files will be automatically insert here -->
    <!-- endinject-->
    <script>
      (function() {
        function ajax(selector, url) {
          var xmlhttp = new XMLHttpRequest(),
              elem = document.querySelector(selector);

          elem.innerHTML = '';
          xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
              if (xmlhttp.status == 200) {
                var html = xmlhttp.responseText;
                html = html.replace(/<script[^>]*>/gi, ' <!-- ');
                html = html.replace(/<\/script>/gi, ' --> ');
                elem.innerHTML = html;
              } else if (xmlhttp.status == 404) {
                alert('Template not found');
              } else {
                alert('GET: ' + url + '\nReturned: '+xmlhttp.status);
              }
            }
          };
          xmlhttp.open('GET', url, true);
          xmlhttp.send();
        }

        function switchLang(lang) {
          try {
            ajax('header', './' + lang + '/header.htm');
            ajax('footer', './' + lang + '/footer.htm');
          } catch (e) {
            console.log(e);
          }
        }

        function updateLoadedStyles() {
          $('#loaded-styles').empty();
          $('link[rel="stylesheet"]').each(function () {
            $('#loaded-styles').append($(this).attr('href') + '\n');
          });
        }

        function injectStylesheets(url) {
          var SERVICE_URL = 'https://lindat-extractor.herokuapp.com';
          localStorage.setItem('url', url);

          $('link[injected]').remove();

          if (!url) {
            updateLoadedStyles();
            return;
          }

          $.ajax(SERVICE_URL + '/styles', {
            data: { uri: url }
          }).done(function (data) {
            data.forEach(function (item) {
              if (/lindat\.css$/.test(item)) {
                return;
              }
              $('head').append('<link rel="stylesheet" href="'+ item + '" type="text/css" injected="injected" />');
            });
            updateLoadedStyles();
          })
        }

        function switchHandle(handle, title) {
          var refbox = document.querySelector('#refbox');
          localStorage.setItem('handle', handle);
          localStorage.setItem('title', title);
          refbox.setAttribute('handle', handle);
          refbox.setAttribute('title', title);
          LindatRefBox(refbox, {
            rest: 'https://ufal-point-dev.ms.mff.cuni.cz/repository/rest'
          });
        }

        function init() {
          Array.prototype.slice.call(document.querySelectorAll('.lang-select')).forEach(function(elm) {
            var value = elm.getAttribute('value');
            elm.addEventListener('click', function() {
              localStorage.setItem('lang', value);
              switchLang(value);
            });
          });

          Array.prototype.slice.call(document.querySelectorAll('.project-select')).forEach(function(elm) {
            var value = elm.getAttribute('value');
            elm.addEventListener('click', function() {
              localStorage.setItem('project', value);
              document.body.setAttribute('id', value);
            });
          });

          Array.prototype.slice.call(document.querySelectorAll('.handle-select')).forEach(function(elm) {
            var value = elm.getAttribute('value');
            elm.addEventListener('click', function() {
              switchHandle(value, elm.textContent);
            });
          });

          Array.prototype.slice.call(document.querySelectorAll('.css-select')).forEach(function(elm) {
            var value = elm.getAttribute('value');
            elm.addEventListener('click', function() {
              injectStylesheets(value);
            });
          });

          var lang = localStorage.getItem('lang') || 'en';
          var project = localStorage.getItem('project') || 'lindat-home';

          var handle = localStorage.getItem('handle') || '11234/1-1508';
          var title = localStorage.getItem('title') || 'HamleDT 3.0';
          var url  = localStorage.getItem('url') || '';

          injectStylesheets(url);
          switchHandle(handle, title);
          document.body.setAttribute('id', project);
          switchLang(lang);
        }

        init();
      }());
    </script>
  </body>
</html>
